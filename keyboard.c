#include "keyboard.h"

static unsigned char g_keyboard_shift = 0;

/* US scancodes set 1
 __________________________________________________________________________
|    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |
|~   |!   |@   |#   |$   |%   |^   |&   |*   |(   |)   |_   |+   ||   |bksp|
|`   |1   |2   |3   |4   |5   |6   |7   |8   |9   |0   |-   |=   |\   |    |
|  29|  02|  03|  04|  05|  06|  07|  08|  09|  0A|  0B|  0C|  0D|  2B|  0E|
|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|
|    |    |    |    |    |    |    |    |    |    |    |    |    |         |
|Tab |Q   |W   |E   |R   |T   |Y   |U   |I   |O   |P   |{   |}   |         |
|    |    |    |    |    |    |    |    |    |    |    |[   |]   |         |
|  0F|  10|  11|  12|  13|  14|  15|  16|  17|  18|  19|  1A|  1B|         |
|____|____|____|____|____|____|____|____|____|____|____|____|____|         |
|    |    |    |    |    |    |    |    |    |    |    |    |              |
|Caps|A   |S   |D   |F   |G   |H   |J   |K   |L   |:   |"   |     Enter    |
|    |    |    |    |    |    |    |    |    |    |;   |'   |              |
|  3A|  1E|  1F|  20|  21|  22|  23|  24|  25|  26|  27|  28|            1C|
|____|____|____|____|____|____|____|____|____|____|____|____|______________|
|         |    |    |    |    |    |    |    |    |    |    |              |
| L Shift |Z   |X   |C   |V   |B   |N   |M   |<   |>   |?   |   R Shift    |
|         |    |    |    |    |    |    |    |,   |.   |/   |              |
|       2A|  2C|  2D|  2E|  2F|  30|  31|  32|  33|  34|  35|            36|
|_________|____|____|____|____|____|____|____|____|____|____|______________|
|       |       |       |                  |       |       |       |       |
|L Ctrl | L win | L Alt |       space      | R Alt | R win | menu  |R Ctrl |
|       |[1]    |       |                  |       |[1]    |[1]    |       |
|     1D|   E05B|     38|                39|   E038|   E05C|   E05D|   E01D|
|_______|_______|_______|__________________|_______|_______|_______|_______|
*/

char lower_case_map[] = {

//   0    1    2    3    4    5    6    7    8    9    A    B
	' ', ' ', '1', '2', '3', '4', '5', '6', '7', '8', '9', '0',
//   C    D    E    F   10   11    12   13  14    15   16  17
	'-', '=', ' ', ' ', 'q', 'w', 'e', 'r', 't', 'y', 'u', 'i',
//  18   19   1A   1B    1C  1D   1E   1F   20   21   22   23
	'o', 'p', '[', ']', '\n', ' ', 'a', 's', 'd', 'f', 'g', 'h',
//  24   25   26   27   28   29   2A   2B   2C   2D   2E   2F
	'j', 'k', 'l', ';', ' ', ' ', ' ', ' ', 'z', 'x', 'c', 'v',
//  30   31   32   33   34   35   36   37   38   39   3A   3B
	'b', 'n', 'm', ',', '.', '/', ' ', ' ', ' ', ' ', ' ', ' '

};

char upper_case_map[] = {

//   0    1    2    3    4    5    6    7    8    9    A    B
	' ', ' ', '!', '@', '#', '$', '%', '^', '&', '*', '(', ')',
//   C    D    E    F   10   11    12   13  14    15   16  17
	'_', '+', ' ', ' ', 'Q', 'W', 'E', 'R', 'T', 'Y', 'U', 'I',
//  18   19   1A   1B    1C  1D   1E   1F   20   21   22   23
	'O', 'P', '{', '}', '\n', ' ', 'A', 'S', 'D', 'F', 'G', 'H',
//  24   25   26   27   28   29   2A   2B   2C   2D   2E   2F
	'J', 'K', 'L', ':', ' ', ' ', ' ', ' ', 'Z', 'X', 'C', 'V',
//  30   31   32   33   34   35   36   37   38   39   3A   3B
	'B', 'N', 'M', '<', '>', '?', ' ', ' ', ' ', ' ', ' ', ' '

};

unsigned char get_char(unsigned char scan_code)
{
	if (scan_code == 0x2a || scan_code == 0x36)
	{
		g_keyboard_shift = 1;
	}
	else if (scan_code == 0xaa || scan_code == 0xb6)
	{
		g_keyboard_shift = 0;
	}
	else if (scan_code > 0 && scan_code < 0x3c)
	{
		if (g_keyboard_shift == 0)
		{
			return lower_case_map[scan_code];
		}
		else
		{
			return upper_case_map[scan_code];
		}
	}

	return 0x80;
}
